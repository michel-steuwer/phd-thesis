% Chapter 5: Code generation using patterns

\chapter{Code generation using patterns}

\label{ch:fifth} % For referencing the chapter elsewhere, use \autoref{ch:name} 
\label{chapter:codeGeneration}

In the last two chapters we discussed how regular parallel pattern, referred to as \emph{algorithmic skeletons}, help to greatly simplify programming of modern parallel systems.
Parallel programming of multi-\GPU systems is considerably simplified without scarifying performance as shown by the evaluation in \autoref{chapter:skelcl-evaluation}.
In this chapter we address the second main challenge identified in \autoref{chapter:background}: \emph{Performance portability}.
We will present a novel approach for generating efficient and specialized code from compositions of algorithmic skeletons and similar high-level \emph{patterns}.
This systematic, rule-based approach provides performance portability across different types of modern parallel processors. 
In the following \autoref{chapter:codeGeneration-evaluation} we will show that this approach generates code matching the performance of highly tuned implementations on \CPUs and \GPUs using a set of example application.

We will start this chapter by looking at optimizations in \OpenCL and how applying them changes the source code of applications.
We will show how these optimizations can be hardware specific breaking portability and, furthermore, how optimizations for one particular hardware architecture can lead to poor performance on other hardware architectures.
All of this will motivate the necessity, when aiming for performance portability, for generating optimized and specialized code from a pattern-based high-level representation.
We will discuss the benefits an approach using code generation offers over a library based approach, like \SkelCL presented in \autoref{chapter:skelcl}.
Then we will give an overview of our approach and present it in more detail in the following sections.
\autoref{chapter:codeGeneration-evaluation} will present an evaluation of the approach using a set of application studies.

\input{Chapters/Chapter5/motivation.tex}

\input{Chapters/Chapter5/overview.tex}

\input{Chapters/Chapter5/patterns.tex}

\input{Chapters/Chapter5/rules.tex}

\input{Chapters/Chapter5/generator.tex}

\section{Summary}
\todo{List contributions and benefits of using the pattern code generator approach}

